---
title: "Basic usage of SPARKI!"
author: "Jacqueline M. Boccacino"
date: "`r Sys.Date()`"
output: 
  html_document:
    code_folding: show
fontsize: 14pt
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
    echo = TRUE, 
    warning = FALSE, 
    message = FALSE
)
knitr::opts_knit$set(root.dir = "/lustre/scratch126/casm/team113da/users/jb62/projects/sparki/")

```

```{r source_code}
#library(SPARKI)
source("R/utilities.R")
source("R/helper.R")
source("R/plotting.R")
source("R/constants.R")
```

# Load data

```{r load_data}
mpa_reports <- load_MPAreports("test/mpa", verbose = FALSE)
std_reports <- load_STDreports("test/reports", verbose = FALSE)
merged_reports <- mergeReports(std_reports, mpa_reports)

mdata <- loadMetadata("test/metadata.csv") # Optional
ref_db <- loadReference("test/inspect.txt")
```

```{r add_metadata}
mdata_columns <- c("Diagnosis_short", "Site_group")
merged_reports <- addMetadata(merged_reports, mdata, "Tumour_RNA", mdata_columns)
```

# Process data

```{r process_data}
merged_reports <- addSampleSize(merged_reports)
merged_reports <- addMinimiserData(merged_reports, ref_db)
merged_reports <- subsetReports(merged_reports, include_human = FALSE)
merged_reports <- assessMinimiserRatio(merged_reports)
merged_reports <- assessStatistics(merged_reports, verbose = TRUE)
```

# Summary of read classification

## Violin plot

```{r plots1, echo = TRUE, fig.retina = 1, fig.width = 4, fig.height = 3.5, fig.align = 'center'}
plotClassificationSummary_violin(
  merged_reports, 
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)
```

## Horizontal bar plot

### Without sample names

```{r plots2, echo = TRUE, fig.retina = 1, fig.width = 6, fig.height = 5, fig.align = 'center'}

plotClassificationSummary_barplot(
  merged_reports, 
  include_sample_names = FALSE, 
  orientation = "horizontal",
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)

```

### With sample names

```{r plots3, echo = TRUE, fig.retina = 1, fig.width = 6, fig.height = 5, fig.align = 'center'}

plotClassificationSummary_barplot(
  merged_reports, 
  include_sample_names = TRUE, 
  orientation = "horizontal",
  return_plot = TRUE,
  prefix = "SebT",
  outdir = "test/outputs/"
)

```

## Vertical bar plot

### Without sample names

```{r plots4, echo = TRUE, fig.retina = 1, fig.width = 5, fig.height = 5, fig.align = 'center'}

plotClassificationSummary_barplot(
  merged_reports, 
  include_sample_names = FALSE, 
  orientation = "vertical",
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)

```

### With sample names

```{r plots5, echo = TRUE, fig.retina = 1, fig.width = 5, fig.height = 5, fig.align = 'center'}

plotClassificationSummary_barplot(
  merged_reports, 
  include_sample_names = TRUE, 
  orientation = "vertical", 
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)

```

## Without Eukaryotes

```{r plots6, echo = TRUE, fig.retina = 1, fig.width = 4, fig.height = 5, fig.align = 'center'}
plotDomainReads_violin(
  merged_reports, 
  include_eukaryotes = FALSE, 
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)
```

```{r plots7, echo = TRUE, fig.retina = 1, fig.width = 4, fig.height = 5, fig.align = 'center'}
plotDomainReads_barplot(
  merged_reports, 
  include_eukaryotes = FALSE, 
  include_sample_names = FALSE, 
  orientation = "vertical", 
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)
```


## With Eukaryotes

```{r plots8, echo = TRUE, fig.retina = 1, fig.width = 4, fig.height = 5, fig.align = 'center'}
plotDomainReads_violin(
  merged_reports, 
  include_eukaryotes = TRUE, 
  return_plot = TRUE,
  outdir = "test/outputs/",
  prefix = "SebT"
)
```

```{r plots9, echo = TRUE, fig.retina = 1, fig.width = 4, fig.height = 5, fig.align = 'center'}
plotDomainReads_barplot(
  merged_reports, 
  include_eukaryotes = TRUE, 
  return_plot = TRUE, 
  include_sample_names = FALSE, 
  orientation = "vertical",
  outdir = "test/outputs/",
  prefix = "SebT"
)
```

```{r plots10, echo = TRUE, fig.retina = 1, fig.width = 25, fig.height = 15, fig.align = 'center'}

plotMinimisers_dotplot(
  merged_reports, 
  domain = "Viruses", 
  return_plot = TRUE, 
  fig_width = 25, 
  fig_height = 15, 
  outdir = "test/outputs/",
  prefix = "SebT"
)
```